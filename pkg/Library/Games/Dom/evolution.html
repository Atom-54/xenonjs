<!doctype html>
<html lang="en">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes, viewport-fit=cover">

<script type="module">
  const surpriseGene = () => {
    return Math.floor(Math.random()*2);
  };
  const initGenome = length => {
    const genome = {
      length,
      genes: [],
      mutantGenes: []
    };
    return genome;
  };
  const randomGenome = genome => {
    for (let i=0; i<genome.length; i++) {
      genome.genes[i] = surpriseGene();
    }
    return genome;
  };
  const is = (genome, ...kinds) => {
    const result = {};
    kinds.forEach(kind => {
      const chromo = chromos[kind];
      const gene = Boolean(genome.genes[chromo]);
      //console.log(kind, chromo, gene);
      if (genome.mutantGenes.includes(chromo)) {
        result.mutant = true;
      }
      result[kind] = gene;
    });
    return result;
  };
  const pretty = d => JSON.stringify(d, null, '  ');
  const info = msg => {
    document.body.appendChild(Object.assign(document.createElement('div'), {innerHTML: msg}));
  };
  const mate = (g0, g1) => {
    const genome = initGenome(g0.length);
    for (let i=0; i<g0.length; i++) {
      let gene;
      if (Math.random() < 0.01) {
        gene = surpriseGene();
        genome.mutantGenes.push(i);
        console.log(`mutation at gene ${i}`)
      } else {
        gene = Math.random() < 0.5 ? g0.genes[i] : g1.genes[i];
      }
      genome.genes[i] = gene;
    }
    return genome;
  };
  //
  const pairs = 6;
  const chromos = {
    bold: 0,
    creamy: 1,
    cheesy: 2,
    saucey: 3
  };
  //
  const parentA = randomGenome(initGenome(pairs));
  console.log(parentA);
  info('parentA: ' + pretty(is(parentA, 'bold', 'cheesy')));
  //
  const parentB =randomGenome(initGenome(pairs));
  console.log(parentB);
  info('parentB: ' + pretty(is(parentB, 'bold', 'cheesy')));
  //
  info('<hr>');
  //
  // generate
  for (let i=0; i<12; i++) {
    //info('++ child ' + i);
    const child = mate(parentA, parentB);
    console.log('child', i, child);
    const id = is(child, 'bold', 'cheesy');
    //console.log(id);
    if (id.bold && id.cheesy) {
      info(`Child (${i}) is bold and cheesy! ${id.mutant ? '(mutant)' : ''}`);
    } else {
      info(`Child (${i}) is not.`);
    }
    //console.log(child.mutantGenes);
  }
  
  // const genome = initGenome(pairs);
  // initGenome(genome);
  // document.body.innerHTML = pretty(is(genome, 'bold', 'cheesy'));
</script>
</html>