var R=()=>Object.create(null),w=(q,O,_)=>{if(q)clearTimeout(q);if(O&&_)return setTimeout(O,_)},C=(q)=>class extends(q??class{}){constructor(){super();this._pendingProps=R(),this._props=this._getInitialProps()||R(),this._lastProps=R(),this._state=this._getInitialState()||R(),this._lastState=R()}_getInitialProps(){}_getInitialState(){}_getProperty(O){return this._pendingProps[O]||this._props[O]}_setProperty(O,_){if(this._validator||this._wouldChangeProp(O,_))this._pendingProps[O]=_,this._invalidateProps()}_wouldChangeValue(O,_,W){return O[_]!==W}_wouldChangeProp(O,_){return this._wouldChangeValue(this._props,O,_)}_wouldChangeState(O,_){return this._wouldChangeValue(this._state,O,_)}_setProps(O){Object.assign(this._pendingProps,O),this._invalidateProps()}_invalidateProps(){this._propsInvalid=!0,this._invalidate()}mergeState(O){let _=!1;const W=this._state;for(let f in O){const z=O[f];if(this._wouldChangeState(f,z))_=!0,W[f]=z}if(_)return this._invalidate(),!0}_setState(O){return this.mergeState(O)}_async(O){return Promise.resolve().then(O.bind(this))}asyncTask(O,_){return setTimeout(_,Number(O)||0)}_invalidate(){if(!this._validator)this._validator=this._async(this._validate)}_getStateArgs(){return[this._props,this._state,this._lastProps,this._lastState]}_validate(){const O=this._getStateArgs();try{if(Object.assign(this._props,this._pendingProps),this._propsInvalid)this._willReceiveProps(...O),this._propsInvalid=!1;if(this._shouldUpdate(...O))this._ensureMount(),this._doUpdate(...O)}catch(_){console.error(_)}this._validator=null,this._lastProps=Object.assign(R(),this._props),this._lastState=Object.assign(R(),this._state)}_doUpdate(...O){this._update(...O),this._didUpdate(...O)}_ensureMount(){}_willReceiveProps(){}_shouldUpdate(){return!0}_update(){}_didUpdate(){}_debounce(O,_,W){O=`_debounce_${O}`,this._state[O]=w(this._state[O],_,W!=null?W:16)}};class D{constructor(q){this.cb=q}annotate(q,O,_){return this.notes=O,this.opts=_||0,this.key=this.opts.key||0,O.locator=this._annotateSubtree(q),O}_annotateSubtree(q){let O;for(let _=0,W=q.firstChild,f=null,z;W;_++){const J=this._annotateNode(W);if(J)(O=O||{})[_]=J;if(z=f?f.nextSibling:q.firstChild,z===W)f=W,W=W.nextSibling;else W=z,_--}return O}_annotateNode(q){const O=this.key++,_=this.cb(q,O,this.notes,this.opts),W=this._annotateSubtree(q);if(_||W){const f=Object.create(null);if(f.key=O,W)f.sub=W;return f}}}var S=function(q,O,_){_=_||[];for(let W in O){const f=O[W];if(f){const z=q.childNodes[W];if(_[f.key]=z.nodeType===Node.TEXT_NODE?z.parentElement:z,f.sub)S(z,f.sub,_)}}return _},g=function(q,O,_,W){let f=!1;if(W.annotator&&W.annotator(q,O,_,W))f=!0;switch(q.nodeType){case Node.DOCUMENT_FRAGMENT_NODE:break;case Node.ELEMENT_NODE:return f||y(q,O,_);case Node.TEXT_NODE:return f||h(q,O,_)}return f},h=function(q,O,_){if(T(q,O,_,"textContent",q.textContent))return q.textContent="",!0},y=function(q,O,_){if(q.hasAttributes()){let W=!1;for(let f=q.attributes,z=f.length-1,J;z>=0&&(J=f[z]);z--)if(i(q,O,_,J.name,J.value)||T(q,O,_,J.name,J.value)||c(q,O,_,J.name,J.value))q.removeAttribute(J.name),W=!0;return W}},T=function(q,O,_,W,f){if(f.slice(0,2)==="{{"){if(W==="class")W="className";let z=f.slice(2,-2);const J=f.includes("=")?"=":":",G=z.split(J);if(G.length===2)W=G[0],z=G[1];if(V(_,O,"mustaches",W,z),z[0]==="$")V(_,"xlate",z,!0);return!0}},i=function(q,O,_,W,f){if(W.slice(0,3)==="on-"){if(f.slice(0,2)==="{{")f=f.slice(2,-2),console.warn(`Xen: event handler for '${W}' expressed as a mustache, which is not supported. Using literal value '${f}' instead.`);return V(_,O,"events",W.slice(3),f),!0}},c=function(q,O,_,W,f){if(W==="xen:forward")return V(_,O,"events","xen:forward",f),!0},V=function(q,O,_,W,f){const z=q[O]||(q[O]=Object.create(null));(z[_]||(z[_]={}))[W]=f},v=new D(g),u=function(q,O,_){return q._notes||(q._notes=v.annotate(q.content,{},O,_))},P=function(q,O,_){for(let W in q){const f=O[W],z=q[W]&&q[W].events;if(f&&z)for(let J in z){let G=J,K=z[G];if(K.includes("="))[G,K]=K.split("=");_(f,G,K)}}},m=function(q,O,_,W){O.addEventListener(_,function(f){if(q[W])return q[W](f,f.detail);else if(q.defaultHandler)return q.defaultHandler(W,f)})},p=function(q,O,_,W){if(_)for(let f in q){const z=O[f];if(z){z.scope=_;const J=q[f].mustaches;for(let G in J){const K=J[G];if(K in _)d(z,G,_[K],W)}}}},d=function(q,O,_,W){const f=O.slice(-1);if(O==="style%"||O==="style"||O==="xen:style")if(typeof _==="string")q.style.cssText=_;else Object.assign(q.style,_);else if(f=="$"){const z=O.slice(0,-1);if(typeof _==="boolean"||_===void 0||_===null)B(q,z,Boolean(_));else q.setAttribute(z,_)}else if(O==="textContent")if(_?.$template||_?.template||Array.isArray(_)||_?.models)s(q,_,W);else{const z=_!==null&&_!==void 0&&typeof _!=="object"&&typeof _!=="function";q.textContent=z?_:""}else if(O==="unsafe-html")q.innerHTML=_||"";else if(O==="value"){if(q.value!==_)q.value=_}else if(O==="focus"&&q.focus)q.focus();else if(O==="src")q.src=_||"";else q[O]=_},B=function(q,O,_){q[(_===void 0?!q.hasAttribute(O):_)?"setAttribute":"removeAttribute"](O,"")},s=function(q,O,_){let{template:W,$template:f,models:z}=O;if(Array.isArray(O))z=O;if(!W){const J=f||q?.getAttribute("repeat");W=q.getRootNode().querySelector(`template[${J}]`)}else W=M(W);r(q,_,W,z)},r=function(q,O,_,W){let f=q.firstElementChild,z;if(_&&W)W&&W.forEach((J,G)=>{if(z=f&&f.nextElementSibling,!f){const K=X(_).events(O);if(f=K.root.firstElementChild,f){if(f._subtreeDom=K,q.appendChild(f),!_._shapeWarning&&K.root.firstElementChild)_._shapeWarning=!0,console.warn("xen-template: subtemplate has multiple root nodes: only the first is used.",_)}}if(f)f._subtreeDom.set(J),f=z});while(f)z=f.nextElementSibling,f.remove(),f=z},X=function(q,O){q=M(q);const _=u(q,O),W=document.importNode(q.content,!0),f=W.firstElementChild,z=S(W,_.locator);return{root:W,notes:_,map:z,firstElement:f,$(G){return this.root.querySelector(G)},$$(G){return this.root.querySelectorAll(G)},set:function(G){return G&&p(_,z,G,this.controller),this},events:function(G){if(G&&typeof G!=="function")G=m.bind(this,G);if(this.controller=G,G)P(_,z,G);return this},forward:function(){return P(_,z,(G,K,H)=>{G.addEventListener(K,(Y)=>{const Z={eventName:K,handlerName:H,detail:Y.detail,target:Y.target};l(G,"xen:forward",Z,{bubbles:!0})})}),this},appendTo:function(G){if(this.root)G.appendChild(this.root);else console.warn("Xen: cannot appendTo, template stamped no DOM");return this.root=G,this}}},l=(q,O,_,W)=>{const f=W||{};f.detail=_;const z=new CustomEvent(O,f);return q.dispatchEvent(z),z.detail},M=(q)=>{return typeof q==="string"?A(q):q},A=(q)=>{return Object.assign(document.createElement("template"),{innerHTML:q})},U={createTemplate:A,setBoolAttribute:B,stamp:X,takeNote:V};var $=(q)=>class extends q{constructor(){super();this._mounted=!1,this._root=this,this.__configureAccessors(),this.__lazyAcquireProps()}get _class(){return this.constructor._class||this.constructor}__configureAccessors(){const O=Object.getPrototypeOf(this);if(!O.hasOwnProperty("__$xenPropsConfigured")){O.__$xenPropsConfigured=!0;const _=this._class.observedAttributes;_&&_.forEach((W)=>{Object.defineProperty(O,W,{get(){return this._getProperty(W)},set(f){this._setProperty(W,f)}})})}}__lazyAcquireProps(){const O=this._class.observedAttributes;O&&O.forEach((_)=>{if(_.toLowerCase()!==_)console.error(`Xen: Mixed-case attributes are not yet supported, "${this.localName}.observedAttributes" contains "${_}".`);if(this.hasOwnProperty(_)){const W=this[_];delete this[_],this[_]=W}else if(this.hasAttribute(_))this._setValueFromAttribute(_,this.getAttribute(_))})}_setValueFromAttribute(O,_){this[O]=_}connectedCallback(){this._mount()}_mount(){if(!this._mounted)this._mounted=!0,this._doMount(),this._didMount()}_doMount(){}_didMount(){}_fire(O,_,W,f){const z=f||{};z.detail=_;const J=new CustomEvent(O,z);return(W||this).dispatchEvent(J),J.detail}};var{HTMLElement:a}=globalThis,L=(q)=>class extends q{get template(){const O=this.constructor.module;return O?O.querySelector("template"):""}get host(){return this.shadowRoot||this.attachShadow({mode:"open"})}_doMount(){this._stamp(),this._invalidate()}_stamp(){if(this.template)this._dom=U.stamp(this.template).events(this._listener.bind(this)).appendTo(this.host)}_listener(O,_,W){O.addEventListener(_,(f)=>{if(this[W])return this[W](f,f.detail,this._props,this._state)})}_doUpdate(...O){this._update(...O);let _=this._render(...O);if(this._dom){if(Array.isArray(_))_=_.reduce((W,f)=>Object.assign(W,f),Object.create(null));this._dom.set(_)}this._didUpdate(...O),this._didRender(...O)}_render(){}_didRender(){}},N=L($(C(a)));var Q=(q,O)=>class extends q{_setProperty(_,W){if(Q.level>1){if((_ in this._pendingProps)&&this._pendingProps[_]!==W||this._props[_]!==W)O("props",F({[_]:W}))}return super._setProperty(_,W)}_setState(_){if(typeof _!=="object")return console.warn("Xen::_setState argument must be an object"),!1;if(super._setState(_)){if(Q.level>1)if(Q.lastFire)O("(fired -->) state",F(_));else O("state",F(_));return!0}}_setImmutableState(_,W){O("state [immutable]",{[_]:W}),super._setImmutableState(_,W)}_fire(_,W,f,z){Q.lastFire={name:_,detail:F(W),log:O},O("fire",{[Q.lastFire.name]:Q.lastFire.detail}),super._fire(_,W,f,z),Q.lastFire=null}_doUpdate(..._){if(Q.level>2)O("updating...");return super._doUpdate(..._)}_invalidate(){if(Q.level>2){if(!this._validator)O("invalidating...")}super._invalidate()}},F=(q,O)=>{if(!q||typeof q!=="object")return q;const _=Object.create(null);for(let W in q){let f=q[W];if(O<1)f=F(q,(O||0)+1);_[W]=f}return _};Q.level=0;var n=(q,O,_="log")=>console[_].bind(console,`%c${q}`,`background: ${O}; color: white; padding: 1px 6px 2px 7px; border-radius: 6px;`),x=(q,O,_)=>Q.level>0?n(q,O,_):()=>{},E=(q,O)=>{let _=O;if(!_)_={};const W=q||document.body;let f=1,z=W.firstElementChild;while(z){const J=z.localName;if(customElements.get(J)){const K=z.shadowRoot,H={node:z,props:z._props,state:z._state},Y=K?E(K):{};if(Y)H.children=Y;let Z=`${J}${z.id?`#${z.id}`:""} (${f++})`;while(_[Z])Z+="_";_[Z]=H}E(z,_),z=z.nextElementSibling}return _};var j=(q,...O)=>{return(q[0]+O.map((_,W)=>_+q[W+1]).join("")).trim()};U.html=(...q)=>U.createTemplate(j(...q));var t=(q)=>typeof q==="object"?Object.assign(Object.create(null),q):{},b={State:C,Template:U,Element:$,BaseMixin:L,Base:N,Debug:Q,setBoolAttribute:U.setBoolAttribute,html:j,walker:E,logFactory:x,clone:t,nob:R,debounce:w};globalThis.Xen=b;var I=b;var k=(q)=>class extends q{set state(O){this._setState(O)}get state(){return this._state}get props(){return this._props}async(O){return this._async(O)}invalidate(O){return this._invalidate(O)}async awaitState(O,_){const W=this._state,f=`_await_${O}`;if(!W[f]){W[f]=!0;const z=await _();this.state={[O]:z,[f]:!1}}}fire(...O){return this._fire(...O)}_getInitialState(){return this.getInitialState&&this.getInitialState()}_update(O,_,W,f){return this.update&&this.update(O,_,W,f)}_render(O,_,W,f){if(this.shouldRender(O,_,W,f))return this.render&&this.render(O,_,W,f)}shouldRender(){return!0}render(O,_){return _}onState(O,_){this._setState({[O.type]:_})}};I.AsyncMixin=k;I.Async=k(I.Base);export{R as nob,w as debounce,C as XenStateMixin,$ as XenElementMixin,L as XenBaseMixin,N as XenBase,k as XenAsyncMixin,I as Xen,U as Template};

//# debugId=177682B700CD3AE164756e2164756e21
