var U=()=>Object.create(null),E=(f,_,O)=>{if(f)clearTimeout(f);if(_&&O)return setTimeout(_,O)},$=(f)=>class extends(f??class{}){constructor(){super();this._pendingProps=U(),this._props=this._getInitialProps()||U(),this._lastProps=U(),this._state=this._getInitialState()||U(),this._lastState=U()}_getInitialProps(){}_getInitialState(){}_getProperty(_){return this._pendingProps[_]||this._props[_]}_setProperty(_,O){if(this._validator||this._wouldChangeProp(_,O))this._pendingProps[_]=O,this._invalidateProps()}_wouldChangeValue(_,O,q){return _[O]!==q}_wouldChangeProp(_,O){return this._wouldChangeValue(this._props,_,O)}_wouldChangeState(_,O){return this._wouldChangeValue(this._state,_,O)}_setProps(_){Object.assign(this._pendingProps,_),this._invalidateProps()}_invalidateProps(){this._propsInvalid=!0,this._invalidate()}mergeState(_){let O=!1;const q=this._state;for(let z in _){const G=_[z];if(this._wouldChangeState(z,G))O=!0,q[z]=G}if(O)return this._invalidate(),!0}_setState(_){return this.mergeState(_)}_async(_){return Promise.resolve().then(_.bind(this))}asyncTask(_,O){return setTimeout(O,Number(_)||0)}_invalidate(){if(!this._validator)this._validator=this._async(this._validate)}_getStateArgs(){return[this._props,this._state,this._lastProps,this._lastState]}_validate(){const _=this._getStateArgs();try{if(Object.assign(this._props,this._pendingProps),this._propsInvalid)this._willReceiveProps(..._),this._propsInvalid=!1;if(this._shouldUpdate(..._))this._ensureMount(),this._doUpdate(..._)}catch(O){console.error(O)}this._validator=null,this._lastProps=Object.assign(U(),this._props),this._lastState=Object.assign(U(),this._state)}_doUpdate(..._){this._update(..._),this._didUpdate(..._)}_ensureMount(){}_willReceiveProps(){}_shouldUpdate(){return!0}_update(){}_didUpdate(){}_debounce(_,O,q){_=`_debounce_${_}`,this._state[_]=E(this._state[_],O,q!=null?q:16)}};class T{constructor(f){this.cb=f}annotate(f,_,O){return this.notes=_,this.opts=O||0,this.key=this.opts.key||0,_.locator=this._annotateSubtree(f),_}_annotateSubtree(f){let _;for(let O=0,q=f.firstChild,z=null,G;q;O++){const K=this._annotateNode(q);if(K)(_=_||{})[O]=K;if(G=z?z.nextSibling:f.firstChild,G===q)z=q,q=q.nextSibling;else q=G,O--}return _}_annotateNode(f){const _=this.key++,O=this.cb(f,_,this.notes,this.opts),q=this._annotateSubtree(f);if(O||q){const z=Object.create(null);if(z.key=_,q)z.sub=q;return z}}}var D=function(f,_,O){O=O||[];for(let q in _){const z=_[q];if(z){const G=f.childNodes[q];if(O[z.key]=G.nodeType===Node.TEXT_NODE?G.parentElement:G,z.sub)D(G,z.sub,O)}}return O},g=function(f,_,O,q){let z=!1;if(q.annotator&&q.annotator(f,_,O,q))z=!0;switch(f.nodeType){case Node.DOCUMENT_FRAGMENT_NODE:break;case Node.ELEMENT_NODE:return z||y(f,_,O);case Node.TEXT_NODE:return z||h(f,_,O)}return z},h=function(f,_,O){if(S(f,_,O,"textContent",f.textContent))return f.textContent="",!0},y=function(f,_,O){if(f.hasAttributes()){let q=!1;for(let z=f.attributes,G=z.length-1,K;G>=0&&(K=z[G]);G--)if(i(f,_,O,K.name,K.value)||S(f,_,O,K.name,K.value)||v(f,_,O,K.name,K.value))f.removeAttribute(K.name),q=!0;return q}},S=function(f,_,O,q,z){if(z.slice(0,2)==="{{"){if(q==="class")q="className";let G=z.slice(2,-2);const K=z.includes("=")?"=":":",J=G.split(K);if(J.length===2)q=J[0],G=J[1];if(V(O,_,"mustaches",q,G),G[0]==="$")V(O,"xlate",G,!0);return!0}},i=function(f,_,O,q,z){if(q.slice(0,3)==="on-"){if(z.slice(0,2)==="{{")z=z.slice(2,-2),console.warn(`Xen: event handler for '${q}' expressed as a mustache, which is not supported. Using literal value '${z}' instead.`);return V(O,_,"events",q.slice(3),z),!0}},v=function(f,_,O,q,z){if(q==="xen:forward")return V(O,_,"events","xen:forward",z),!0},V=function(f,_,O,q,z){const G=f[_]||(f[_]=Object.create(null));(G[O]||(G[O]={}))[q]=z},c=new T(g),u=function(f,_,O){return f._notes||(f._notes=c.annotate(f.content,{},_,O))},L=function(f,_,O){for(let q in f){const z=_[q],G=f[q]&&f[q].events;if(z&&G)for(let K in G){let J=K,Q=G[J];if(Q.includes("="))[J,Q]=Q.split("=");O(z,J,Q)}}},m=function(f,_,O,q){_.addEventListener(O,function(z){if(f[q])return f[q](z,z.detail);else if(f.defaultHandler)return f.defaultHandler(q,z)})},p=function(f,_,O,q){if(O)for(let z in f){const G=_[z];if(G){G.scope=O;const K=f[z].mustaches;for(let J in K){const Q=K[J];if(Q in O)d(G,J,O[Q],q)}}}},d=function(f,_,O,q){const z=_.slice(-1);if(_==="style%"||_==="style"||_==="xen:style")if(typeof O==="string")f.style.cssText=O;else Object.assign(f.style,O);else if(z=="$"){const G=_.slice(0,-1);if(typeof O==="boolean"||O===void 0||O===null)B(f,G,Boolean(O));else f.setAttribute(G,O)}else if(_==="textContent")if(O?.$template||O?.template||Array.isArray(O)||O?.models)s(f,O,q);else{const G=O!==null&&O!==void 0&&typeof O!=="object"&&typeof O!=="function";f.textContent=G?O:""}else if(_==="unsafe-html")f.innerHTML=O||"";else if(_==="value"){if(f.value!==O)f.value=O}else if(_==="focus"&&f.focus)f.focus();else if(_==="src"){const G=O||"";if(f._src!==G)f._src=G,f.src=G}else f[_]=O},B=function(f,_,O){f[(O===void 0?!f.hasAttribute(_):O)?"setAttribute":"removeAttribute"](_,"")},s=function(f,_,O){let{template:q,$template:z,models:G}=_;if(Array.isArray(_))G=_;if(!q){const K=z||f?.getAttribute("repeat");q=f.getRootNode().querySelector(`template[${K}]`)}else q=M(q);r(f,O,q,G)},r=function(f,_,O,q){let z=f.firstElementChild,G;if(O&&q)q&&q.forEach((K,J)=>{if(G=z&&z.nextElementSibling,!z){const Q=X(O).events(_);if(z=Q.root.firstElementChild,z){if(z._subtreeDom=Q,f.appendChild(z),!O._shapeWarning&&Q.root.firstElementChild)O._shapeWarning=!0,console.warn("xen-template: subtemplate has multiple root nodes: only the first is used.",O)}}if(z)z._subtreeDom.set(K),z=G});while(z)G=z.nextElementSibling,z.remove(),z=G},X=function(f,_){f=M(f);const O=u(f,_),q=document.importNode(f.content,!0),z=q.firstElementChild,G=D(q,O.locator);return{root:q,notes:O,map:G,firstElement:z,$(J){return this.root.querySelector(J)},$$(J){return this.root.querySelectorAll(J)},set:function(J){return J&&p(O,G,J,this.controller),this},events:function(J){if(J&&typeof J!=="function")J=m.bind(this,J);if(this.controller=J,J)L(O,G,J);return this},forward:function(){return L(O,G,(J,Q,H)=>{J.addEventListener(Q,(Y)=>{const Z={eventName:Q,handlerName:H,detail:Y.detail,target:Y.target};l(J,"xen:forward",Z,{bubbles:!0})})}),this},appendTo:function(J){if(this.root)J.appendChild(this.root);else console.warn("Xen: cannot appendTo, template stamped no DOM");return this.root=J,this}}},l=(f,_,O,q)=>{const z=q||{};z.detail=O;const G=new CustomEvent(_,z);return f.dispatchEvent(G),G.detail},M=(f)=>{return typeof f==="string"?A(f):f},A=(f)=>{return Object.assign(document.createElement("template"),{innerHTML:f})},W={createTemplate:A,setBoolAttribute:B,stamp:X,takeNote:V};var w=(f)=>class extends f{constructor(){super();this._mounted=!1,this._root=this,this.__configureAccessors(),this.__lazyAcquireProps()}get _class(){return this.constructor._class||this.constructor}__configureAccessors(){const _=Object.getPrototypeOf(this);if(!_.hasOwnProperty("__$xenPropsConfigured")){_.__$xenPropsConfigured=!0;const O=this._class.observedAttributes;O&&O.forEach((q)=>{Object.defineProperty(_,q,{get(){return this._getProperty(q)},set(z){this._setProperty(q,z)}})})}}__lazyAcquireProps(){const _=this._class.observedAttributes;_&&_.forEach((O)=>{if(O.toLowerCase()!==O)console.error(`Xen: Mixed-case attributes are not yet supported, "${this.localName}.observedAttributes" contains "${O}".`);if(this.hasOwnProperty(O)){const q=this[O];delete this[O],this[O]=q}else if(this.hasAttribute(O))this._setValueFromAttribute(O,this.getAttribute(O))})}_setValueFromAttribute(_,O){this[_]=O}connectedCallback(){this._mount()}_mount(){if(!this._mounted)this._mounted=!0,this._doMount(),this._didMount()}_doMount(){}_didMount(){}_fire(_,O,q,z){const G=z||{};G.detail=O;const K=new CustomEvent(_,G);return(q||this).dispatchEvent(K),K.detail}};var{HTMLElement:a}=globalThis,P=(f)=>class extends f{get template(){const _=this.constructor.module;return _?_.querySelector("template"):""}get host(){return this.shadowRoot||this.attachShadow({mode:"open"})}_doMount(){this._stamp(),this._invalidate()}_stamp(){if(this.template)this._dom=W.stamp(this.template).events(this._listener.bind(this)).appendTo(this.host)}_listener(_,O,q){_.addEventListener(O,(z)=>{if(this[q])return this[q](z,z.detail,this._props,this._state)})}_doUpdate(..._){this._update(..._);let O=this._render(..._);if(this._dom){if(Array.isArray(O))O=O.reduce((q,z)=>Object.assign(q,z),Object.create(null));this._dom.set(O)}this._didUpdate(..._),this._didRender(..._)}_render(){}_didRender(){}},N=P(w($(a)));var R=(f,_)=>class extends f{_setProperty(O,q){if(R.level>1){if((O in this._pendingProps)&&this._pendingProps[O]!==q||this._props[O]!==q)_("props",F({[O]:q}))}return super._setProperty(O,q)}_setState(O){if(typeof O!=="object")return console.warn("Xen::_setState argument must be an object"),!1;if(super._setState(O)){if(R.level>1)if(R.lastFire)_("(fired -->) state",F(O));else _("state",F(O));return!0}}_setImmutableState(O,q){_("state [immutable]",{[O]:q}),super._setImmutableState(O,q)}_fire(O,q,z,G){R.lastFire={name:O,detail:F(q),log:_},_("fire",{[R.lastFire.name]:R.lastFire.detail}),super._fire(O,q,z,G),R.lastFire=null}_doUpdate(...O){if(R.level>2)_("updating...");return super._doUpdate(...O)}_invalidate(){if(R.level>2){if(!this._validator)_("invalidating...")}super._invalidate()}},F=(f,_)=>{if(!f||typeof f!=="object")return f;const O=Object.create(null);for(let q in f){let z=f[q];if(_<1)z=F(f,(_||0)+1);O[q]=z}return O};R.level=0;var n=(f,_,O="log")=>console[O].bind(console,`%c${f}`,`background: ${_}; color: white; padding: 1px 6px 2px 7px; border-radius: 6px;`),x=(f,_,O)=>R.level>0?n(f,_,O):()=>{},C=(f,_)=>{let O=_;if(!O)O={};const q=f||document.body;let z=1,G=q.firstElementChild;while(G){const K=G.localName;if(customElements.get(K)){const Q=G.shadowRoot,H={node:G,props:G._props,state:G._state},Y=Q?C(Q):{};if(Y)H.children=Y;let Z=`${K}${G.id?`#${G.id}`:""} (${z++})`;while(O[Z])Z+="_";O[Z]=H}C(G,O),G=G.nextElementSibling}return O};var j=(f,..._)=>{return(f[0]+_.map((O,q)=>O+f[q+1]).join("")).trim()};W.html=(...f)=>W.createTemplate(j(...f));var t=(f)=>typeof f==="object"?Object.assign(Object.create(null),f):{},b={State:$,Template:W,Element:w,BaseMixin:P,Base:N,Debug:R,setBoolAttribute:W.setBoolAttribute,html:j,walker:C,logFactory:x,clone:t,nob:U,debounce:E};globalThis.Xen=b;var I=b;var k=(f)=>class extends f{set state(_){this._setState(_)}get state(){return this._state}get props(){return this._props}async(_){return this._async(_)}invalidate(_){return this._invalidate(_)}async awaitState(_,O){const q=this._state,z=`_await_${_}`;if(!q[z]){q[z]=!0;const G=await O();this.state={[_]:G,[z]:!1}}}fire(..._){return this._fire(..._)}_getInitialState(){return this.getInitialState&&this.getInitialState()}_update(_,O,q,z){return this.update&&this.update(_,O,q,z)}_render(_,O,q,z){if(this.shouldRender(_,O,q,z))return this.render&&this.render(_,O,q,z)}shouldRender(){return!0}render(_,O){return O}onState(_,O){this._setState({[_.type]:O})}};I.AsyncMixin=k;I.Async=k(I.Base);export{U as nob,E as debounce,$ as XenStateMixin,w as XenElementMixin,P as XenBaseMixin,N as XenBase,k as XenAsyncMixin,I as Xen,W as Template};

//# debugId=9BBAB508552B64B564756e2164756e21
