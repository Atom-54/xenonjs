var l=["log","warn","error","group","groupCollapsed","groupEnd"],_=["warn","error"],w=(A,x,u)=>{const D=`background: ${x||"gray"}; color: ${u||"white"}; padding: 1px 6px 2px 7px; border-radius: 6px 0 0 6px;`;return[`%c${A}`,D]},Y=[],t=()=>{const A=globalThis.config?.logFlags||{},x=(E,P,T)=>{const B=w(E,P,T),M=($)=>(...L)=>{const v=Date.now(),C=Error().stack.split("\n").slice(1);let Z=C.shift();while(Z.includes("xen-async")||Z.includes("xenon-atomic")||Z.includes("logf"))Z=C.shift();const h=Z?.split?.("/").pop().split?.(")").shift();u(E,B,$,v,h,L,Y),D(A,E,B,$,v,h,L)},N=M("log");return l.forEach(($)=>N[$]=M($)),N.flags=A,N.get=x.get,N.clear=x.clear,N.replay=x.replay,N},u=(E,P,T,B,M,N)=>{const $=Object.create(null);if(Object.assign($,{preamble:E,format:P,kind:T,where:M,when:B}),N?.length)$.args=N},D=(E,P,T,B,M,N,$)=>{const L=P.split(":").shift();if(!E||E?.[L]||E?.[P]||_.includes(B))console[B].apply(console,[...T,...$||[],`\t[${N}]`])};return x.flags=A,x.get=()=>Y,x.clear=()=>Y.splice(0,-1),x.replay=(E,P)=>{console.group.apply(console,[...w("Logger","white","gray"),"Replay"]),Y.filter(P??((T)=>T)).forEach(({preamble:T,format:B,kind:M,when:N,where:$,args:L})=>{D(E,T,B,M,N,$,L)}),console.groupEnd()},x};if(globalThis.logf)console.warn("attempted global logf overwrite");else globalThis.logf=t();var X3=globalThis.logf;var U=logf("Composer","#c36834");class y{constructor(){this.slots={},this.pendingPackets=[]}processPendingPackets(){const A=this.pendingPackets;if(A.length)this.pendingPackets=[],A.forEach((x)=>{x.pendCount=(x.pendCount||0)+1,this.render(x)})}render(A){const{content:{model:x,template:u},...D}=A;U({...D,model:x});const{id:E,container:P}=D,T=E;if(x?.$clear)this._clearSlot(T);else if(u){let B=this.slots[T];if(B&&B.container!==P)this._clearSlot(T),B=null;if(!B)B=this.maybeGenerateSlot(A);if(B)this.renderSlot(B,A)}}renderSlot(A,{container:x,content:{model:u}}){this.maybeReattachSlot(A,x),A.set(u),this.processPendingPackets()}maybeGenerateSlot(A){const{id:x,container:u,content:{template:D}}=A,E=x,P=this.findContainer(u);if(P){const T=this.generateSlot(x,u,D,P);return T.container=u,this.slots[E]=T,T}this.pendingPackets.push(A),U(`container [${u}] unavailable for slot [${E}]`)}_clearSlot(A){const x=this.slots[A];if(x)this.processPendingPackets(),this.slots[A]=null,this.clearSlot(x)}clearSlot(A){}findContainer(A){return null}generateSlot(A,x,u){return null}onevent(A,x){U(`[${A}] sent [${x.handler}] event`)}requestFontFamily(A){return!1}}var S=()=>Object.create(null),b=(A,x,u)=>{if(A)clearTimeout(A);if(x&&u)return setTimeout(x,u)},K=(A)=>class extends(A??class{}){constructor(){super();this._pendingProps=S(),this._props=this._getInitialProps()||S(),this._lastProps=S(),this._state=this._getInitialState()||S(),this._lastState=S()}_getInitialProps(){}_getInitialState(){}_getProperty(x){return this._pendingProps[x]||this._props[x]}_setProperty(x,u){if(this._validator||this._wouldChangeProp(x,u))this._pendingProps[x]=u,this._invalidateProps()}_wouldChangeValue(x,u,D){return x[u]!==D}_wouldChangeProp(x,u){return this._wouldChangeValue(this._props,x,u)}_wouldChangeState(x,u){return this._wouldChangeValue(this._state,x,u)}_setProps(x){Object.assign(this._pendingProps,x),this._invalidateProps()}_invalidateProps(){this._propsInvalid=!0,this._invalidate()}mergeState(x){let u=!1;const D=this._state;for(let E in x){const P=x[E];if(this._wouldChangeState(E,P))u=!0,D[E]=P}if(u)return this._invalidate(),!0}_setState(x){return this.mergeState(x)}_async(x){return Promise.resolve().then(x.bind(this))}asyncTask(x,u){return setTimeout(u,Number(x)||0)}_invalidate(){if(!this._validator)this._validator=this._async(this._validate)}_getStateArgs(){return[this._props,this._state,this._lastProps,this._lastState]}_validate(){const x=this._getStateArgs();try{if(Object.assign(this._props,this._pendingProps),this._propsInvalid)this._willReceiveProps(...x),this._propsInvalid=!1;if(this._shouldUpdate(...x))this._ensureMount(),this._doUpdate(...x)}catch(u){console.error(u)}this._validator=null,this._lastProps=Object.assign(S(),this._props),this._lastState=Object.assign(S(),this._state)}_doUpdate(...x){this._update(...x),this._didUpdate(...x)}_ensureMount(){}_willReceiveProps(){}_shouldUpdate(){return!0}_update(){}_didUpdate(){}_debounce(x,u,D){x=`_debounce_${x}`,this._state[x]=b(this._state[x],u,D!=null?D:16)}};class k{constructor(A){this.cb=A}annotate(A,x,u){return this.notes=x,this.opts=u||0,this.key=this.opts.key||0,x.locator=this._annotateSubtree(A),x}_annotateSubtree(A){let x;for(let u=0,D=A.firstChild,E=null,P;D;u++){const T=this._annotateNode(D);if(T)(x=x||{})[u]=T;if(P=E?E.nextSibling:A.firstChild,P===D)E=D,D=D.nextSibling;else D=P,u--}return x}_annotateNode(A){const x=this.key++,u=this.cb(A,x,this.notes,this.opts),D=this._annotateSubtree(A);if(u||D){const E=Object.create(null);if(E.key=x,D)E.sub=D;return E}}}var J=function(A,x,u){u=u||[];for(let D in x){const E=x[D];if(E){const P=A.childNodes[D];if(u[E.key]=P.nodeType===Node.TEXT_NODE?P.parentElement:P,E.sub)J(P,E.sub,u)}}return u},f=function(A,x,u,D){let E=!1;if(D.annotator&&D.annotator(A,x,u,D))E=!0;switch(A.nodeType){case Node.DOCUMENT_FRAGMENT_NODE:break;case Node.ELEMENT_NODE:return E||e(A,x,u);case Node.TEXT_NODE:return E||O(A,x,u)}return E},O=function(A,x,u){if(g(A,x,u,"textContent",A.textContent))return A.textContent="",!0},e=function(A,x,u){if(A.hasAttributes()){let D=!1;for(let E=A.attributes,P=E.length-1,T;P>=0&&(T=E[P]);P--)if(x3(A,x,u,T.name,T.value)||g(A,x,u,T.name,T.value)||u3(A,x,u,T.name,T.value))A.removeAttribute(T.name),D=!0;return D}},g=function(A,x,u,D,E){if(E.slice(0,2)==="{{"){if(D==="class")D="className";let P=E.slice(2,-2);const T=E.includes("=")?"=":":",B=P.split(T);if(B.length===2)D=B[0],P=B[1];if(W(u,x,"mustaches",D,P),P[0]==="$")W(u,"xlate",P,!0);return!0}},x3=function(A,x,u,D,E){if(D.slice(0,3)==="on-"){if(E.slice(0,2)==="{{")E=E.slice(2,-2),console.warn(`Xen: event handler for '${D}' expressed as a mustache, which is not supported. Using literal value '${E}' instead.`);return W(u,x,"events",D.slice(3),E),!0}},u3=function(A,x,u,D,E){if(D==="xen:forward")return W(u,x,"events","xen:forward",E),!0},W=function(A,x,u,D,E){const P=A[x]||(A[x]=Object.create(null));(P[u]||(P[u]={}))[D]=E},A3=new k(f),D3=function(A,x,u){return A._notes||(A._notes=A3.annotate(A.content,{},x,u))},Q=function(A,x,u){for(let D in A){const E=x[D],P=A[D]&&A[D].events;if(E&&P)for(let T in P){let B=T,M=P[B];if(M.includes("="))[B,M]=M.split("=");u(E,B,M)}}},E3=function(A,x,u,D){x.addEventListener(u,function(E){if(A[D])return A[D](E,E.detail);else if(A.defaultHandler)return A.defaultHandler(D,E)})},P3=function(A,x,u,D){if(u)for(let E in A){const P=x[E];if(P){P.scope=u;const T=A[E].mustaches;for(let B in T){const M=T[B];if(M in u)T3(P,B,u[M],D)}}}},T3=function(A,x,u,D){const E=x.slice(-1);if(x==="style%"||x==="style"||x==="xen:style")if(typeof u==="string")A.style.cssText=u;else Object.assign(A.style,u);else if(E=="$"){const P=x.slice(0,-1);if(typeof u==="boolean"||u===void 0||u===null)G(A,P,Boolean(u));else A.setAttribute(P,u)}else if(x==="textContent")if(u?.$template||u?.template||Array.isArray(u)||u?.models)B3(A,u,D);else{const P=u!==null&&u!==void 0&&typeof u!=="object"&&typeof u!=="function";A.textContent=P?u:""}else if(x==="unsafe-html")A.innerHTML=u||"";else if(x==="value"){if(A.value!==u)A.value=u}else if(x==="focus"&&A.focus)A.focus();else if(x==="src"){const P=u||"";if(A._src!==P)A._src=P,A.src=P}else A[x]=u},G=function(A,x,u){A[(u===void 0?!A.hasAttribute(x):u)?"setAttribute":"removeAttribute"](x,"")},B3=function(A,x,u){let{template:D,$template:E,models:P}=x;if(Array.isArray(x))P=x;if(!D){const T=E||A?.getAttribute("repeat");D=A.getRootNode().querySelector(`template[${T}]`)}else D=d(D);M3(A,u,D,P)},M3=function(A,x,u,D){let E=A.firstElementChild,P;if(u&&D)D&&D.forEach((T,B)=>{if(P=E&&E.nextElementSibling,!E){const M=i(u).events(x);if(E=M.root.firstElementChild,E){if(E._subtreeDom=M,A.appendChild(E),!u._shapeWarning&&M.root.firstElementChild)u._shapeWarning=!0,console.warn("xen-template: subtemplate has multiple root nodes: only the first is used.",u)}}if(E)E._subtreeDom.set(T),E=P});while(E)P=E.nextElementSibling,E.remove(),E=P},i=function(A,x){A=d(A);const u=D3(A,x),D=document.importNode(A.content,!0),E=D.firstElementChild,P=J(D,u.locator);return{root:D,notes:u,map:P,firstElement:E,$(T){return this.root.querySelector(T)},$$(T){return this.root.querySelectorAll(T)},set:function(T){return T&&P3(u,P,T,this.controller),this},events:function(T){if(T&&typeof T!=="function")T=E3.bind(this,T);if(this.controller=T,T)Q(u,P,T);return this},forward:function(){return Q(u,P,(T,B,M)=>{T.addEventListener(B,(N)=>{const $={eventName:B,handlerName:M,detail:N.detail,target:N.target};N3(T,"xen:forward",$,{bubbles:!0})})}),this},appendTo:function(T){if(this.root)T.appendChild(this.root);else console.warn("Xen: cannot appendTo, template stamped no DOM");return this.root=T,this}}},N3=(A,x,u,D)=>{const E=D||{};E.detail=u;const P=new CustomEvent(x,E);return A.dispatchEvent(P),P.detail},d=(A)=>{return typeof A==="string"?m(A):A},m=(A)=>{return Object.assign(document.createElement("template"),{innerHTML:A})},X={createTemplate:m,setBoolAttribute:G,stamp:i,takeNote:W},c=(A)=>class extends A{constructor(){super();this._mounted=!1,this._root=this,this.__configureAccessors(),this.__lazyAcquireProps()}get _class(){return this.constructor._class||this.constructor}__configureAccessors(){const x=Object.getPrototypeOf(this);if(!x.hasOwnProperty("__$xenPropsConfigured")){x.__$xenPropsConfigured=!0;const u=this._class.observedAttributes;u&&u.forEach((D)=>{Object.defineProperty(x,D,{get(){return this._getProperty(D)},set(E){this._setProperty(D,E)}})})}}__lazyAcquireProps(){const x=this._class.observedAttributes;x&&x.forEach((u)=>{if(u.toLowerCase()!==u)console.error(`Xen: Mixed-case attributes are not yet supported, "${this.localName}.observedAttributes" contains "${u}".`);if(this.hasOwnProperty(u)){const D=this[u];delete this[u],this[u]=D}else if(this.hasAttribute(u))this._setValueFromAttribute(u,this.getAttribute(u))})}_setValueFromAttribute(x,u){this[x]=u}connectedCallback(){this._mount()}_mount(){if(!this._mounted)this._mounted=!0,this._doMount(),this._didMount()}_doMount(){}_didMount(){}_fire(x,u,D,E){const P=E||{};P.detail=u;const T=new CustomEvent(x,P);return(D||this).dispatchEvent(T),T.detail}},{HTMLElement:$3}=globalThis,p=(A)=>class extends A{get template(){const x=this.constructor.module;return x?x.querySelector("template"):""}get host(){return this.shadowRoot||this.attachShadow({mode:"open"})}_doMount(){this._stamp(),this._invalidate()}_stamp(){if(this.template)this._dom=X.stamp(this.template).events(this._listener.bind(this)).appendTo(this.host)}_listener(x,u,D){x.addEventListener(u,(E)=>{if(this[D])return this[D](E,E.detail,this._props,this._state)})}_doUpdate(...x){this._update(...x);let u=this._render(...x);if(this._dom){if(Array.isArray(u))u=u.reduce((D,E)=>Object.assign(D,E),Object.create(null));this._dom.set(u)}this._didUpdate(...x),this._didRender(...x)}_render(){}_didRender(){}},H3=p(c(K($3))),H=(A,x)=>class extends A{_setProperty(u,D){if(H.level>1){if((u in this._pendingProps)&&this._pendingProps[u]!==D||this._props[u]!==D)x("props",V({[u]:D}))}return super._setProperty(u,D)}_setState(u){if(typeof u!=="object")return console.warn("Xen::_setState argument must be an object"),!1;if(super._setState(u)){if(H.level>1)if(H.lastFire)x("(fired -->) state",V(u));else x("state",V(u));return!0}}_setImmutableState(u,D){x("state [immutable]",{[u]:D}),super._setImmutableState(u,D)}_fire(u,D,E,P){H.lastFire={name:u,detail:V(D),log:x},x("fire",{[H.lastFire.name]:H.lastFire.detail}),super._fire(u,D,E,P),H.lastFire=null}_doUpdate(...u){if(H.level>2)x("updating...");return super._doUpdate(...u)}_invalidate(){if(H.level>2){if(!this._validator)x("invalidating...")}super._invalidate()}},V=(A,x)=>{if(!A||typeof A!=="object")return A;const u=Object.create(null);for(let D in A){let E=A[D];if(x<1)E=V(A,(x||0)+1);u[D]=E}return u};H.level=0;var L3=(A,x,u="log")=>console[u].bind(console,`%c${A}`,`background: ${x}; color: white; padding: 1px 6px 2px 7px; border-radius: 6px;`),S3=(A,x,u)=>H.level>0?L3(A,x,u):()=>{},I=(A,x)=>{let u=x;if(!u)u={};const D=A||document.body;let E=1,P=D.firstElementChild;while(P){const T=P.localName;if(customElements.get(T)){const B=P.shadowRoot,M={node:P,props:P._props,state:P._state},N=B?I(B):{};if(N)M.children=N;let $=`${T}${P.id?`#${P.id}`:""} (${E++})`;while(u[$])$+="_";u[$]=M}I(P,u),P=P.nextElementSibling}return u},s=(A,...x)=>{return(A[0]+x.map((u,D)=>u+A[D+1]).join("")).trim()};X.html=(...A)=>X.createTemplate(s(...A));var Z3=(A)=>typeof A==="object"?Object.assign(Object.create(null),A):{},z={State:K,Template:X,Element:c,BaseMixin:p,Base:H3,Debug:H,setBoolAttribute:X.setBoolAttribute,html:s,walker:I,logFactory:S3,clone:Z3,nob:S,debounce:b};globalThis.Xen=z;var j=z,q=(A)=>class extends A{set state(x){this._setState(x)}get state(){return this._state}get props(){return this._props}async(x){return this._async(x)}invalidate(x){return this._invalidate(x)}async awaitState(x,u){const D=this._state,E=`_await_${x}`;if(!D[E]){D[E]=!0;const P=await u();this.state={[x]:P,[E]:!1}}}fire(...x){return this._fire(...x)}_getInitialState(){return this.getInitialState&&this.getInitialState()}_update(x,u,D,E){return this.update&&this.update(x,u,D,E)}_render(x,u,D,E){if(this.shouldRender(x,u,D,E))return this.render&&this.render(x,u,D,E)}shouldRender(){return!0}render(x,u){return u}onState(x,u){this._setState({[x.type]:u})}};j.AsyncMixin=q;j.Async=q(j.Base);var n=`
:root {
  --icon-font: 'Material Symbols Outlined'
}
icon {
  font-family: var(--icon-font);
  font-weight: normal;
  font-style: normal;
  /* font-size: 24px; */
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  font-feature-settings: "liga";
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased;
}
`;var r=`
:host {
  --xen-pad: 8px;
  --cell-margin: var(--xen-pad) var(--xen-pad) 0 0;
  --cell-pad: var(--xen-pad);
}
* {
  box-sizing: border-box;
}
[rows], [column], [columns], [row], [bar], [toolbar] {
  display: flex;
  align-items: stretch;
}
[rows], [column] {
  flex-direction: column;
}
[centered][rows], [centered][column], [centering][columns], [centering][row], [bar], [toolbar] {
  align-items: center;
}
[centered][columns], [centered][row], [centering][rows], [centering][column] {
  justify-content: center;
}
[center] {
  justify-content: center;
  align-items: center;
  text-align: center;
  align-content: center;
}
[right-aligned] {
  align-items: end;
  align-content: end;
  justify-content: right;
  text-align: right;
}
[left-aligned] {
  align-items: start;
  align-content: start;
  justify-content: left;
  text-align: left;
}
[evenly-aligned] {
  align-content: space-evenly;
}
[spacer] {
  padding: 8px;
}
[bar], [toolbar]  {
  white-space: nowrap;
}
[toolbar] {
  padding: var(--xen-pad);
}
[toolbar] > * {
  margin-right: var(--xen-pad);
}
[toolbar] > *:last-child {
  margin-right: 0;
}
[fullbleed] {
  height: 100dvh;
  width: 100dvw;
  /* height: 100%;
  width: 100%; */
  margin: 0;
  overflow: hidden;
}
[dark] {
  color-scheme: dark;
}
[scrolling] {
  overflow: auto !important;
}
[flex] {
  flex: 1 1 0;
}
[flex][x2] {
  flex: 2;
}
[flex][x3] {
  flex: 3;
}
[flex][x4] {
  flex: 4;
}
[flex][x5] {
  flex: 5;
}
[flex][x6] {
  flex: 6;
}
[flex][x7] {
  flex: 7;
}
[flex][scrolling] {
  height: 0;
  flex: 1 1 auto;
}
[grid] {
  display: flex;
  flex-wrap: wrap;
}
[grid] > * {
  flex: 1 0 0;
  margin: var(--cell-margin);
  padding: var(--cell-pad);
}
[hidden], [hide]:not([hide="false"]), [display="hide"], [display="false"], [show="false"] {
  display: none !important;
}
[invisible] {
  visibility: hidden;
}
[clip] {
  overflow: hidden;
}
[noclip] {
  overflow: visible;
}
[trbl] {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}
[no-events] {
  pointer-events: none;
}
icon {
  font-family: var(--icon-font);
  font-weight: normal;
  font-style: normal;
  /* font-size: 24px; */
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  font-feature-settings: "liga";
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased;
}
`;var V3=Object.create(null),Q3=customElements.define.bind(customElements),a=(A,x)=>Object.assign(document.createElement(A),x||V3),F=(A,x,u)=>u?u.appendChild(a(A,x)):a(A,x);var R=(A)=>A.replace(/[$)(:]/g,"_");class W3 extends y{constructor(A,x,u){super();this.root=A,this.useShadowRoot=x,this.onevent=u}setRoot(A){this.root=A,this.processPendingPackets()}findContainer(A){let x=this.root;if(A?.[0]==="#")x=o(document.body,A);else if(A&&A!=="root"){const[u,D]=A.split("#");x=o(x,`#${R(u)}`)}return x}generateSlot(A,x,u,D){if(!D)throw Error("Cannot generateSlot without a parent node");const E=R(A),P=R(A.split("$").pop().toLowerCase()),T=F(`${P}-atom`,{atomId:A,id:E,slot:x?.split("#").pop()},D);T.setAttribute("atom","");const B=!A.toLowerCase().startsWith("a_")&&this.useShadowRoot?T.attachShadow({mode:"open"}):T,M=`/*injected by XenComposer*/${n}${r}`;return F("style",{innerHTML:M},B),j.Template.stamp(u).appendTo(B).events(this.mapEvent.bind(this,A))}maybeReattachSlot(A,x){if(!A.root.isConnected)this.findContainer(x)?.appendChild(A.root.host)}clearSlot(A){A.root.host.remove()}mapEvent(A,x,u,D){x.addEventListener(u,(E)=>{E.stopPropagation(),E.preventDefault();const P={key:null,value:null},T=E.composedPath();let B;for(B of T){if(B.nodeType===Node.ELEMENT_NODE){if("key"in B)P.key=B.key;else if(B.hasAttribute("key"))P.key=B.getAttribute("key");if(B.value!==void 0)P.value=B.value;else if(("checked"in B)&&B.checked!==void 0)P.value=B.checked;else if("value"in B)P.value=B.value;else if(B.hasAttribute("value"))P.value=B.getAttribute("value")}if(E.currentTarget===B||P.key||P.value)break}if(E.currentTarget&&E instanceof WheelEvent){const{deltaX:N,deltaY:$,deltaZ:L,deltaMode:v}=E,{scrollTop:C,scrollLeft:Z}=E.currentTarget;Object.assign(P,{deltaX:N,deltaY:$,deltaZ:L,deltaMode:v,scrollTop:C,scrollLeft:Z})}const M={name:u,handler:D,data:P};this.onevent(A,M)})}requestFontFamily(A){const x={rel:"stylesheet",href:`https://fonts.googleapis.com/css2?family=${A}&display=swap`};return F("link",x,document.head),!0}}var o=(A,x)=>{const u=(D,E)=>{let P;while(D&&!P)P=(D.matches&&D.matches(E)?D:null)||u(D.firstElementChild,E)||D.shadowRoot&&u(D.shadowRoot.firstElementChild,E),D=D.nextElementSibling;return P};return u(A||document.body,x)};export{X3 as logf,l as logKinds,_ as importantKinds,t as createLogFactory,W3 as XenComposer};
